# 지뢰 찾기 게임

## 기능 목록

- [1차: 싱글플레이](#싱글플레이)
- [2차: 멀티플레이](#멀티플레이)

### 1차: 싱글플레이 <a id="싱글플레이"></a>

#### 난이도 선택

- 사용자가 난이도를 선택 (쉬움, 보통, 어려움)
- 각 난이도별 설정값
    - 쉬움: 9×9, 지뢰 10개
    - 보통: 15×15, 지뢰 40개
    - 어려움: 20×20, 지뢰 80개
- 예외) 존재하지 않는 난이도를 입력한 경우
- 예외 발생 시 에러 메시지를 출력하고 다시 입력받는다

#### 게임판 생성

- 선택한 난이도에 맞춰 보드 생성
- 각 칸은 다음 정보를 가진다
    - 지뢰 여부
    - 열린 상태 여부
    - 깃발 표시 여부
    - 주변 지뢰 개수
- 지뢰 무작위 위치에 배치
- 주변 지뢰 개수를 계산하여 각 칸에 저장

#### 게임판 출력

- 콘솔에 현재 보드 상태를 출력
    - 닫힌 칸: `□`
    - 열린 칸: 인접 지뢰 수 표시 or `■`
    - 깃발 표시된 칸: `⚑`
    - 지뢰: `☼`
- 깃발 개수 출력
    - 초기값: 지뢰 개수
    - 사용 시 개수 차감
- 게임 진행 중 매 턴마다 보드를 갱신하여 출력

#### 명령어 입력

- 사용자가 한 턴에 한 번씩 명령어를 입력
    - `open x y` : (x, y) 좌표의 칸을 연다
    - `flag x y` : (x, y) 좌표의 깃발 표시를 토글한다
    - `exit` : 게임을 종료한다
- 예외) 존재하지 않는 명령어를 입력한 경우
- 예외) 좌표가 범위를 벗어난 경우
- 예외) 좌표 입력을 숫자로 하지 않은 경우
- 예외) 이미 열린 칸이나 깃발 칸에 열기 시도하는 경우
- 예외) 이미 열린 칸에 깃발을 꽂는 경우
- 예외) 남은 깃발 개수를 초과해서 깃발을 꽂는 경우
- 예외 발생 시 에러 메시지를 출력하고 다시 입력받는다

#### 셀 오픈

- 지정된 좌표의 칸을 연다
    - 해당 칸이 지뢰인 경우 게임 종료 (패배)
    - 주변 지뢰 개수가 0인 경우 주변 칸을 자동으로 연다 (재귀적 오픈)
- 열린 칸의 수를 카운트하여 승리 조건 체크에 사용
    - if (열린 칸 수 == 전체 칸 - 지뢰 수) 승리

#### 승리 및 패배 판정

- 패배 조건: 지뢰가 있는 칸을 열었을 경우
    - 모든 지뢰 위치를 공개
    - "지뢰를 밟았습니다! 💣 💣 게임 종료🥺" 메시지 출력
- 승리 조건: 모든 비지뢰 칸을 연 경우
    - "모든 지뢰를 찾았습니다! 🎉 🎉" 메시지 출력
    - 게임 종료

#### 타이머 기능

- 게임 시작 시각을 기록
- 게임 종료 시점에서 경과 시간을 계산
- 최종 결과와 함께 총 소요 시간: 00:00 를 출력

#### 재시작 / 종료

- 게임 종료 후 다음 선택지를 출력
    - `retry` → 새 난이도로 게임 재시작
    - `exit` → 프로그램 종료
- 예외) 잘못된 입력일 경우 다시 입력 요청

<br/>

### 2차: 멀티플레이 (쉬움 난이도로 고정) <a id="멀티플레이"></a>

#### 서버 실행

- 서버를 실행하면 대기 상태로 진입하여 클라이언트 접속을 기다림
- 두 명의 클라이언트가 모두 접속되면 게임을 자동으로 시작
- 서버는 다음 역할 담당
    - 클라이언트 연결 관리 및 방 생성
    - 게임 보드 생성 및 상태 유지
    - 클라이언트 입력 브로드캐스트

#### 클라이언트 접속

- 프로그램 실행 시 사용자가 모드를 선택
    - 싱글플레이
    - 멀티플레이
- 선택에 따라 분기
    - 싱글플레이: 1차 기능 그대로 실행
    - 멀티플레이: 서버/클라이언트 접속 단계로 이동
- 예외) 잘못된 번호 입력 시
    - 예외 발생 시 에러 메시지를 출력하고 다시 입력받는다
- 접속 성공 시 대기 화면 출력 ("다른 플레이어를 기다리는 중...")
- 두 번째 플레이어가 접속하면 서버가 "게임 시작" 신호를 보낸다
- 예외) 서버에 접속 실패 시 에러 메시지 출력 후 재입력 요청

#### 게임 시작

- 서버에서 난이도 쉬움(9×9, 지뢰 10개) 보드 생성
- 대전 진행하는 클라이언트에게 동일한 보드 상태를 전송

#### 명령어 입력

- 게임 종료 전까지 다음 명령을 입력 가능
    - `open x y` : 해당 칸 열기
    - `flag x y` : 깃발 토글
    - `quit` : 게임 종료
- 예외 발생 시 에러 메시지를 출력하고 다시 입력받는다
- 예외) 좌표 범위 초과, 이미 열린 칸, 잘못된 명령어 입력 시

#### 서버-클라이언트 통신

- 서버는 클라이언트의 명령을 수신
    - 게임 로직 실행
    - 모든 클라이언트에게 변경된 보드 상태를 브로드캐스트

#### 승리 및 패배 판정

- 패배 조건: 누군가 지뢰를 열면 즉시 게임 종료
    - 서버는 모든 클라이언트에 게임종료 상태를 브로드캐스트
        - 누가 지뢰를 밟았는지 표시
        - 지뢰 밟은 클라이언트에게 패배, 다른 클라이언트에게 승리 메세지 출력
- 승리 조건: 모든 비지뢰 칸이 열렸을 경우
    - 서버는 모든 클라이언트에 게임종료 상태를 브로드캐스트
        - 모든 비지뢰 칸 연 클라이언트에게 승리, 다른 클라이언트에게 패배 메세지 출력
- 게임 종료 후 보드를 공개 (모든 지뢰 표시)

#### 연결 종료 처리

- 한 명이 종료 명령어 입력 또는 비정상적 종료 시 게임 종료
    - 비정상적 종료 상황
        - 네트워크 끊김
        - 프로그램 종료
- 다른 클라이언트에게 상대가 게임을 종료했다는 메세지 출력
- 서버는 클라이언트 연결을 닫고 세션을 종료

#### 로그 및 상태 관리

- 서버는 다음 정보를 로그로 남김
    - 접속/종료 이벤트
    - 명령 실행 내역
    - 게임 종료 사유 (승리, 패배, 종료)
- 각 세션은 독립적으로 관리